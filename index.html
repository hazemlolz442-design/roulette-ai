<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…Ø­Ù„Ù„ Ø°ÙƒÙŠ - ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø±ÙˆÙ„ÙŠØª (Markov)</title>
<style>
  body { font-family: "Cairo", sans-serif; background:#f6fbff; color:#111; padding:18px; text-align:center; }
  h1 { color:#0a66c2; margin-bottom:6px; }
  p.lead { color:#333; margin-top:6px; margin-bottom:14px; }
  .controls { margin:10px 0 16px; }
  input[type="text"] { padding:10px; width:220px; border-radius:8px; border:1px solid #ccc; text-align:center; font-size:15px; }
  button { padding:9px 14px; margin:6px 6px 6px 0; border-radius:8px; border:none; background:#0a66c2; color:#fff; font-weight:700; cursor:pointer; }
  button.danger { background:#d9534f; }
  button.secondary { background:#6c757d; }
  table { width:100%; max-width:720px; margin:14px auto; border-collapse:collapse; font-size:14px; }
  th, td { padding:8px 6px; border-bottom:1px solid #e0e6ef; text-align:center; }
  th { background:#eef6ff; color:#0a66c2; }
  #predictionBox { margin-top:18px; display:inline-block; text-align:right; padding:14px 18px; background:#fff; border-radius:12px; box-shadow:0 6px 18px rgba(10,102,194,0.06); min-width:320px; }
  .pred-row { margin:6px 0; font-size:16px; }
  .bar { height:10px; background:#e6f0ff; border-radius:8px; overflow:hidden; margin-top:6px; }
  .bar > i { display:block; height:100%; background:#0a66c2; width:0%; }
  .small { font-size:13px; color:#555; }
  .note { color:#666; font-size:13px; margin-top:10px; }
  .status { margin-top:10px; color:#0a66c2; font-weight:700; }
  .flex { display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap; }
  .btn-undo { background:#ffb74d; color:#000; }
</style>
</head>
<body>

<h1>ğŸ¯ Ù…Ø­Ù„Ù„ Ø°ÙƒÙŠ â€” ØªÙˆÙ‚Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h1>
<p class="lead">Ø§ÙƒØªØ¨ Ù†ØªÙŠØ¬Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: Ø¨Ø·ÙŠØ®ØŒ Ø¨Ø±ØªÙ‚Ø§Ù„ØŒ ØªÙØ§Ø­ØŒ Ø®ØµØŒ Ø³Ù…ÙƒØŒ Ø¨Ø±Ø¬Ø±ØŒ Ø¬Ù…Ø¨Ø±ÙŠØŒ Ø¯Ø¬Ø§Ø¬ â€” Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ©</p>

<div class="controls">
  <input id="resultInput" type="text" placeholder="Ù…Ø«Ø§Ù„: ØªÙØ§Ø­" />
  <button onclick="addResult()">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button class="btn-undo" onclick="undoLast()">â†¶ ØªØ±Ø§Ø¬Ø¹ Ø¢Ø®Ø±</button>
  <button class="secondary" onclick="exportData()">â¬‡ï¸ ØªØµØ¯ÙŠØ± (JSON)</button>
  <button class="secondary" onclick="importPrompt()">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
  <button class="danger" onclick="resetAll()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</div>

<div style="max-width:760px;margin:0 auto;">
  <table id="statsTable">
    <thead>
      <tr><th>Ø§Ù„Ø±Ù…Ø²</th><th>Ù…Ø±Ø§Øª Ø§Ù„Ø¸Ù‡ÙˆØ±</th><th>Ø§Ù„Ù†Ø³Ø¨Ø© %</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div id="predictionBox">
  <div style="text-align:center;font-weight:800;font-size:18px">ğŸ”® Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù‚Ø§Ø¯Ù…</div>
  <div id="predictionList" style="margin-top:10px">
    <div class="note">Ø£Ø¶Ù Ù†ØªØ§Ø¦Ø¬ (Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 2) Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„ØªÙˆÙ‚Ø¹.</div>
  </div>
  <div class="status" id="statusLine"></div>
</div>

<div class="note" style="max-width:760px;margin:14px auto;">
  Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù‡Ù†Ø§ Ø®ÙÙŠÙ ÙˆÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ ØªØ³Ù„Ø³Ù„ÙŠ (Markov order 2) Ù…Ø¹ ØªØ±Ø§Ø¬Ø¹ Ù„Ù„Ù€order1 ÙˆÙˆØ²Ù† Ù„Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©ØŒ ÙˆÙŠØ¶ÙŠÙ Ù…Ù‚Ø¯Ø§Ø±Ù‹Ø§ ØµØºÙŠØ±Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ø¨Ø­ÙŠØ« Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ù„ÙŠØ³Øª Ø¬Ø§Ù…Ø¯Ø©. Ù„ÙŠØ³Øª Ø¶Ù…Ø§Ù†Ù‹Ø§ Ù„Ù„ÙÙˆØ² â€” Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ© ÙÙ‚Ø·.
</div>

<script>
/* ------------------ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ------------------ */
const symbols = ["Ø¨Ø·ÙŠØ®","Ø¨Ø±ØªÙ‚Ø§Ù„","ØªÙØ§Ø­","Ø®Ø³","Ø³Ù…Ùƒ","Ø¨Ø±Ø¬Ø±","Ø¬Ù…Ø¨Ø±ÙŠ","Ø¯Ø¬Ø§Ø¬"]; // Ù„Ø§Ø­Ø¸: "Ø®Øµ" ÙÙŠ Ø·Ù„Ø¨ Ø³Ø§Ø¨Ù‚ØŒ Ø§Ø³ØªØ®Ø¯Ù…Øª "Ø®Ø³" ÙƒÙ…Ø·Ø§Ø¨Ù‚Ø© Ø¹Ø±Ø¨ÙŠØ© Ø´Ø§Ø¦Ø¹Ø©
// ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙØ¶Ù„ "Ø®Øµ" Ø¨Ø¯Ù„ "Ø®Ø³":
// const symbols = ["Ø¨Ø·ÙŠØ®","Ø¨Ø±ØªÙ‚Ø§Ù„","ØªÙØ§Ø­","Ø®Øµ","Ø³Ù…Ùƒ","Ø¨Ø±Ø¬Ø±","Ø¬Ù…Ø¨Ø±ÙŠ","Ø¯Ø¬Ø§Ø¬"];

let results = []; // Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
// Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ù„ØªØ¯Ø±ÙŠØ¨:
let trans2 = {}; // key = prev2 + '|' + prev1  => { nextSymbol: count, ... }
let trans1 = {}; // key = prev1 => { nextSymbol: count, ... }
let globalCounts = {}; // {symbol: count}

// ØªØ­Ù…Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© (localStorage)
function loadFromStorage(){
  try {
    const raw = localStorage.getItem('roulette_ai_data_v1');
    if(raw){
      const obj = JSON.parse(raw);
      results = obj.results || [];
      trans2 = obj.trans2 || {};
      trans1 = obj.trans1 || {};
      globalCounts = obj.globalCounts || {};
    } else {
      // init counts
      symbols.forEach(s=> globalCounts[s]=0);
    }
  } catch(e){
    console.error(e);
    symbols.forEach(s=> globalCounts[s]=0);
  }
}
function saveToStorage(){
  const obj = { results, trans2, trans1, globalCounts };
  localStorage.setItem('roulette_ai_data_v1', JSON.stringify(obj));
}

/* ------------------ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªÙ†Ø¨Ø¤ ------------------ */
function train_add(prev, next){
  // update trans1
  if(!trans1[prev]) trans1[prev] = {};
  trans1[prev][next] = (trans1[prev][next]||0) + 1;
}
function train_add2(prev2, prev1, next){
  const key = prev2 + '|' + prev1;
  if(!trans2[key]) trans2[key] = {};
  trans2[key][next] = (trans2[key][next]||0) + 1;
}
function rebuildFromResults(){
  trans2 = {};
  trans1 = {};
  globalCounts = {};
  symbols.forEach(s=> globalCounts[s]=0);
  for(let i=0;i<results.length;i++){
    const cur = results[i];
    globalCounts[cur] = (globalCounts[cur]||0) + 1;
    if(i>=1){
      const prev1 = results[i-1];
      train_add(prev1, cur);
    }
    if(i>=2){
      const prev2 = results[i-2];
      const prev1 = results[i-1];
      train_add2(prev2, prev1, cur);
    }
  }
  saveToStorage();
}

/* ------------------ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« ------------------ */
function renderStats(){
  const tbody = document.querySelector("#statsTable tbody");
  tbody.innerHTML = "";
  const total = results.length || 0;
  // ensure all symbols shown
  symbols.forEach(sym=>{
    const count = globalCounts[sym] || 0;
    const pct = total>0 ? ((count/total)*100).toFixed(1) : "0.0";
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${sym}</td><td>${count}</td><td>${pct}%</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('statusLine').textContent = `Ø³Ø¬Ù‘ÙÙ„: ${total} Ù„ÙØ© Ù…Ø­ÙÙˆØ¸Ø©`;
}

/* ---------- Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙƒÙŠ (Markov order2 + backoff + randomness) ---------- */
function predictTop3(){
  const outDiv = document.getElementById('predictionList');
  outDiv.innerHTML = "";
  if(results.length < 2){
    outDiv.innerHTML = `<div class="note">Ø£Ø¯Ø®Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù†ØªÙŠØ¬ØªÙŠÙ† Ù„Ù„Ø¨Ø¯Ø¡</div>`;
    return;
  }
  // Ù†Ø³ØªØ®Ø¯Ù…: ÙˆØ²Ù†2 Ù„Ù„Ù€order2ØŒ ÙˆØ²Ù†1 Ù„Ù„Ù€order1ØŒ ÙˆØ²Ù†G Ù„Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø§Ù…
  const weight2 = 0.60;
  const weight1 = 0.30;
  const weightG = 0.10;
  // last two
  const last1 = results[results.length-1];
  const last2 = results[results.length-2];

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ù„ÙƒÙ„ Ø±Ù…Ø²
  const scores = {};
  symbols.forEach(s => scores[s] = 0.001); // Ù‚Ø§Ø¹Ø¯Ø© ØµØºÙŠØ±Ø© Ù„Ù„Ù€smoothing

  // order2 contributions
  const key2 = last2 + '|' + last1;
  if(trans2[key2]){
    const map = trans2[key2];
    const sum = Object.values(map).reduce((a,b)=>a+b,0);
    Object.entries(map).forEach(([sym,c])=>{
      scores[sym] += weight2 * (c / sum);
    });
  } else {
    // Ù„Ùˆ Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª order2 Ù†Ù‡Ù…Ø´Ù‡Ø§ (weights ØªÙˆØ²Ø¹ Ù„Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰)
  }

  // order1 contributions
  if(trans1[last1]){
    const map1 = trans1[last1];
    const sum1 = Object.values(map1).reduce((a,b)=>a+b,0);
    Object.entries(map1).forEach(([sym,c])=>{
      scores[sym] += weight1 * (c / sum1);
    });
  }

  // global frequency contribution
  const totGlobal = Object.values(globalCounts).reduce((a,b)=>a+b,0) || 1;
  Object.entries(globalCounts).forEach(([sym,c])=>{
    scores[sym] += weightG * (c / totGlobal);
  });

  // Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ø­Ø³ÙˆØ¨ (ØµØºÙŠØ±) Ù„Ø¥Ø¯Ø®Ø§Ù„ ØªÙ†ÙˆØ¹
  const randomnessStrength = 0.08; // Ø¶Ø¨Ø· Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  symbols.forEach(sym=>{
    scores[sym] += Math.random() * randomnessStrength;
  });

  // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØªØ±ØªÙŠØ¨
  const arr = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top3 = arr.slice(0,3);
  // Ø§Ø­Ø³Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø£ÙˆØ²Ø§Ù† top3 Ù„Ù„ØªØ·Ø¨ÙŠØ¹ Ù„Ù„Ø¹Ø±Ø¶
  const totalTop = top3.reduce((s,[k,v])=>s+v,0) || 1;

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø¨Ø§Ø± ÙˆÙ†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ù† Ù…Ø¬Ù…Ù„ top3
  top3.forEach(([sym, val], idx)=>{
    const pct = ((val/totalTop)*100).toFixed(1);
    const row = document.createElement('div');
    row.className = 'pred-row';
    row.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;">
        <div style="text-align:right;"><strong>${idx+1}ï¸âƒ£ ${sym}</strong></div>
        <div style="min-width:90px;text-align:left;font-weight:800">${pct}%</div>
      </div>
      <div class="bar"><i style="width:${pct}%;"></i></div>
    `;
    outDiv.appendChild(row);
  });
}

/* ------------------ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø¥Ø¶Ø§ÙØ©/ØªØ±Ø§Ø¬Ø¹/Ù…Ø³Ø­ ------------------ */
function addResult(){
  const input = document.getElementById('resultInput');
  const v = input.value.trim();
  if(!v){
    alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  if(!symbols.includes(v)){
    alert('Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ§Ù„ÙŠØ©:\n' + symbols.join(' ØŒ '));
    return;
  }
  // Ø£Ø¶Ù ÙˆÙ‚Ù… Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¬Ø²Ø¦ÙŠ
  if(results.length >= 1){
    train_add(results[results.length-1], v);
  }
  if(results.length >= 2){
    train_add2(results[results.length-2], results[results.length-1], v);
  }
  results.push(v);
  globalCounts[v] = (globalCounts[v]||0) + 1;
  saveToStorage();
  input.value = '';
  renderStats();
  predictTop3();
}

function undoLast(){
  if(results.length === 0) return;
  results.pop();
  // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø§Ù„ØµÙØ± Ù„Ø¶Ù…Ø§Ù† Ø§ØªØ³Ø§Ù‚ Ø§Ù„Ø¹Ø¯Ù‘Ø§Øª
  rebuildFromResults();
  renderStats();
  predictTop3();
}

function resetAll(){
  if(!confirm('Ù‡Ù„ Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
  results = [];
  trans2 = {};
  trans1 = {};
  globalCounts = {};
  symbols.forEach(s=> globalCounts[s]=0);
  saveToStorage();
  renderStats();
  predictTop3();
}

/* ---------- Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª (JSON) ---------- */
function exportData(){
  const data = { results, trans2, trans1, globalCounts };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'roulette_ai_data.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function importPrompt(){
  const text = prompt('Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ JSON Ù„Ù„ØªØ¹ÙˆÙŠØ¶/Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø³ÙŠØ­Ù„ Ù…Ø­Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©):');
  if(!text) return;
  try {
    const obj = JSON.parse(text);
    results = obj.results || [];
    trans2 = obj.trans2 || {};
    trans1 = obj.trans1 || {};
    globalCounts = obj.globalCounts || {};
    saveToStorage();
    renderStats();
    predictTop3();
    alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
  } catch(e){
    alert('ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: JSON ØºÙŠØ± ØµØ­ÙŠØ­');
  }
}

/* ------------------ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ ------------------ */
loadFromStorage();
renderStats();
predictTop3();

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Enter Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø³Ø±Ø¹Ø©
document.getElementById('resultInput').addEventListener('keyup', function(e){
  if(e.key === 'Enter') addResult();
});
</script>

</body>
</html>
```î¨0î¨‚
